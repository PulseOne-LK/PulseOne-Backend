apiVersion: v1
kind: ConfigMap
metadata:
  name: kong-config
data:
  kong.yaml: |
    _format_version: "3.0"

    # Global CORS plugin
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:3000"
            - "https://your-frontend-domain.com"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
            - HEAD
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-CSRF-Token
            - Origin
            - X-Requested-With
            - x-user-id
            - x-user-role
          exposed_headers:
            - Link
            - Authorization
          credentials: true
          max_age: 3600
          preflight_continue: false

    services:
      - name: auth-service
        url: http://auth-service:8080
        routes:
          - name: auth-route
            paths:
              - /auth
            strip_path: true

      - name: profile-service
        url: http://profile-service:8082
        routes:
          - name: profile-route
            paths:
              - /profile
            strip_path: true

      - name: appointments-service
        url: http://appointments-service:8083
        routes:
          - name: appointments-route
            paths:
              - /appointments
            strip_path: true